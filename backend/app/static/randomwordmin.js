const cyrillicRegex=/^(?!.*-;)[\p{Script=Cyrillic}\p{P}\p{S}\s\d]+$/u,latinRegex=/^(?!.*-;)[A-Za-z\d\s\p{P}\p{S}]+$/u,vnRegex=/^[^\-\;]+$/;let tag,currentLanguage,setWord,vncheck,rucheck,encheck,isValid,language,idEdit,currentTab,currentId,index,randomIndex,newRandomIndex,clearBtn=document.querySelector("#clear-list-button"),randomBtn=document.querySelector("#start-random-button"),displayBtn=document.querySelector("#visible-list-button"),inputElm=document.querySelector("#input-word"),addBtn=document.querySelector("#add-button"),listAreaElm=document.querySelector(".list-area"),tags=listAreaElm.querySelectorAll(".tags"),listAreaLength=tags.length,editTabBtns=document.querySelectorAll("#edit-button"),deleteTabBtns=document.querySelectorAll("#delete-button"),id=0,isEdit=!1,isDisplay=!1,isOrigin=!0,alertElm=document.querySelector(".alert"),closeElm=document.querySelector(".close"),previosElm=document.querySelector(".previous"),nextElm=document.querySelector(".next"),contentAlertElm=document.querySelector(".content-alert"),contentFrontElm=document.querySelector(".front"),contentBackElm=document.querySelector(".back"),wordAlert="",scriptAlert="",tabList=[];async function postData(e){const t=await fetch("/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(`${e}`)});return window.location.reload(),t}async function updatetData(e){postData(e)}async function deleteData(e){const t=await fetch("/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(`${e}`)});return window.location.reload(),t}let clearList=function(){isEdit=!1,listAreaElm.innerHTML="",tags=[],id=0,inputElm.value=""},addTab=function(e){postData(e)},setContent=function(e){updatetData(e),isEdit=!isEdit},alertContent=(e,t)=>{isOrigin?(contentAlertElm.style.transform="rotateY(0deg)",contentFrontElm.style.transform="rotateY(0deg)",contentBackElm.innerHTML="",contentFrontElm.innerHTML=e):(contentAlertElm.style.transform="rotateY(180deg)",contentBackElm.style.transform="rotateY(180deg)",contentFrontElm.innerHTML="",contentBackElm.innerHTML=t)},active=function(e){e.classList.add("active")},deActive=function(){let e=listAreaElm.querySelector(".active");e&&e.classList.remove("active")};function checkInputString(e){if(currentLanguage=document.querySelector("#change-language-button").getAttribute("src"),!e.includes(";"))return e.includes("-")?(e=e.split("-"),vncheck=vnRegex.test(inputElm.value.split("-")[0].trim()),rucheck=cyrillicRegex.test(inputElm.value.split("-")[1].trim()),encheck=latinRegex.test(inputElm.value.split("-")[1].trim()),"/static/Icons/russia.png"===currentLanguage?{isValid:vncheck&&rucheck,language:"russian"}:{isValid:vncheck&&encheck,language:"english"}):(language="/static/Icons/russia.png"==currentLanguage?"russian":"english",{isValid:!1,language:language});inputElm.value.split(";").forEach(e=>{if(""!=e.trim())return setWord=e.trim(),setWord.includes("-")?(setWord=setWord.split("-"),vncheck=vnRegex.test(setWord[0].trim()),rucheck=cyrillicRegex.test(setWord[1].trim()),encheck=latinRegex.test(setWord[1].trim()),"/static/Icons/russia.png"===currentLanguage?{isValid:vncheck&&rucheck,language:"russian"}:{isValid:vncheck&&encheck,language:"english"}):(language="/static/Icons/russia.png"==currentLanguage?"russian":"english",{isValid:!1,language:language})})}let addOrEditTabs=function(){let e=inputElm.value;if(""==e.trim())return void alert("You must enter a word!");let{isValid:t,language:n}=checkInputString(e.trim());return isEdit&&t?(setContent(e),void(inputElm.value="")):t?(addTab(e),void(inputElm.value="")):void alert(`Incorect input value! Have to enter [vietnamese - ${n}] word\n[KEY - VALUE] or sequence [KEY - VALUE; KEY - VALUE; KEY - VALUE]`)};clearBtn.onclick=()=>{clearList()},displayBtn.onclick=()=>{isDisplay=!isDisplay,isDisplay?(listAreaElm.style.display="none",displayBtn.src="static/Icons/invisible.png"):(listAreaElm.style.display="block",displayBtn.src="static/Icons/visible.png")},randomBtn.onclick=()=>{if(0==tags.length)return void alert("Do not have any words in the list!");randomIndex=newRandomIndex;do{newRandomIndex=Math.floor(Math.random()/(1/listAreaLength))}while(newRandomIndex==listAreaLength||randomIndex==newRandomIndex&&listAreaLength>1);tag=tags[newRandomIndex];let e=tag.querySelector("p").innerText.trim(),t=tag.getAttribute("name");alertElm.style.display="block",isOrigin=!0,alertContent(e,t),wordAlert=e,scriptAlert=t},previosElm.onclick=()=>{0==newRandomIndex?newRandomIndex=tags.length-1:newRandomIndex-=1,tag=tags[newRandomIndex],isOrigin=!0,alertContent(tag.querySelector("p").innerText.trim(),tag.getAttribute("name")),wordAlert=tag.querySelector("p").innerText.trim(),scriptAlert=tag.getAttribute("name")},nextElm.onclick=()=>{newRandomIndex==tags.length-1?newRandomIndex=0:newRandomIndex+=1,tag=tags[newRandomIndex],isOrigin=!0,alertContent(tag.querySelector("p").innerText.trim(),tag.getAttribute("name")),wordAlert=tag.querySelector("p").innerText.trim(),scriptAlert=tag.getAttribute("name")},tags.forEach(e=>{e.addEventListener("click",()=>{let t=e.querySelector("p").innerText.trim(),n=e.getAttribute("name").trim();newRandomIndex=Number(e.getAttribute("id")),isOrigin=!0,alertElm.style.display="block",alertContent(t,n),wordAlert=t,scriptAlert=n})}),editTabBtns.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),currentId=Number(e.parentElement.parentElement.id),deActive(),currentId==idEdit?(isEdit=!isEdit,isEdit?(currentTab=e.parentElement.parentElement,active(e.parentElement.parentElement),inputElm.focus(),inputElm.value=currentTab.querySelector("p").innerText.trim()+" - "+currentTab.getAttribute("name").trim()):inputElm.value=""):(isEdit=!0,active(e.parentElement.parentElement),currentTab=e.parentElement.parentElement,inputElm.focus(),inputElm.value=currentTab.querySelector("p").innerText.trim()+" - "+currentTab.getAttribute("name").trim()),idEdit=currentId})}),deleteTabBtns.forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation(),currentTab=e.parentElement.parentElement,deleteData(currentTab.querySelector("p").innerText.trim()+" - "+currentTab.getAttribute("name").trim()),isEdit&&(inputElm.value=""),isEdit=!1,deActive(),e.parentElement.parentElement.remove()})}),addBtn.onclick=()=>{addOrEditTabs()},inputElm.onkeydown=e=>{"Enter"==e.key&&addOrEditTabs()},contentAlertElm.onclick=e=>{isOrigin=!isOrigin,alertContent(wordAlert,scriptAlert)},closeElm.onclick=()=>{alertElm.style.display="none"};